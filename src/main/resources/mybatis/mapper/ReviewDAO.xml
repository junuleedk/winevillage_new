<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.winevillage.review.IReviewService">
	<!-- (USER측)현재 이벤트 리스트 출력 -->
	<select id="listReview" resultType="com.winevillage.review.ReviewDTO"
			parameterType="com.winevillage.parameter.ParameterDTO">
		SELECT * FROM (
            SELECT Tb.*, rownum rNum FROM (
                SELECT * FROM review
                WHERE 1=1
                	AND product_code=#{product_code}
                ORDER BY no DESC
            ) Tb
        )
        WHERE rNum <![CDATA[>=]]> #{start}
        AND rNum <![CDATA[<=]]> #{end}
    </select>
    
    <!-- (USER측)리뷰 페이지 출력 -->
	<select id="viewReview" resultType="com.winevillage.review.ReviewDTO"
			parameterType="com.winevillage.parameter.ParameterDTO">
	SELECT * FROM review WHERE no=#{no}
	</select>
	
	<select id="getReviewStatus" resultType="java.util.HashMap">
    SELECT 
        COUNT(*) AS "reviewCount",
        NVL(ROUND(AVG(TO_NUMBER(star)) / 20, 1), 0) AS "ratingStar"
    FROM review
    WHERE product_code = #{product_code}
    </select>
</mapper>